# Система аналитики Kiruhak

Система для отслеживания посещений ваших сайтов с детальной статистикой.

## Возможности

- ✅ Отслеживание посещений в реальном времени
- ✅ Подсчет уникальных посетителей
- ✅ Анализ популярных страниц
- ✅ Источники трафика
- ✅ Время на сайте
- ✅ Статистика по периодам (1 день, 7 дней, 30 дней, 90 дней)
- ✅ Простая интеграция с любым сайтом

## Как использовать

### 1. Добавление нового сайта

1. Перейдите на страницу `/analytics`
2. Заполните форму:

   - **Название сайта** - любое удобное название
   - **Домен** - домен вашего сайта (например: `example.com`)
   - **Описание** - необязательно

3. Нажмите "Добавить сайт"

### 2. Получение кода отслеживания

1. В списке сайтов найдите нужный сайт
2. Нажмите "Показать код"
3. Скопируйте полученный код

### 3. Интеграция на сайт

Добавьте скопированный код в секцию `<head>` вашего сайта:

```html
<head>
  <!-- Другие теги -->

  <!-- Kiruhak Analytics -->
  <script>
    window.KIRUHAK_SITE_ID = "your-site-id";
  </script>
  <script src="https://kiruhak11.ru/analytics.js"></script>
  <!-- End Kiruhak Analytics -->
</head>
```

### 4. Просмотр статистики

1. Перейдите на страницу `/analytics`
2. Выберите сайт из списка
3. Выберите период для анализа
4. Изучите статистику:
   - Общее количество посещений
   - Уникальные посетители
   - Популярные страницы
   - Источники трафика

## API Endpoints

### Отслеживание посещений

```
POST /api/analytics/track
```

**Параметры:**

- `siteId` (обязательно) - ID сайта
- `page` - текущая страница
- `referrer` - источник перехода
- `userAgent` - User-Agent браузера
- `sessionId` - ID сессии
- `userId` - ID пользователя (если есть)

### Получение статистики

```
GET /api/analytics/stats?siteId={siteId}&period={period}
```

**Параметры:**

- `siteId` (обязательно) - ID сайта
- `period` - период (1d, 7d, 30d, 90d)

### Управление сайтами

```
GET /api/sites - список всех сайтов
POST /api/sites - создание нового сайта
```

## Что отслеживается

### Автоматически

- Посещения страниц
- Время на сайте
- Источники трафика (referrer)
- User-Agent браузера
- IP адрес (для подсчета уникальных посетителей)
- Сессии пользователей

### Ручное отслеживание событий

```javascript
// Отслеживание кастомных событий
window.KiruhakAnalytics.trackEvent("button_click", {
  buttonName: "contact_form",
  page: "/contact",
});

// Отслеживание конверсий
window.KiruhakAnalytics.trackEvent("conversion", {
  type: "form_submit",
  value: 1000,
});
```

## Безопасность

- IP адреса используются только для подсчета уникальных посетителей
- Данные не передаются третьим лицам
- Все запросы защищены от CORS
- Поддержка HTTPS

## Технические детали

### База данных

Система использует PostgreSQL с Prisma ORM:

- **Site** - информация о сайтах
- **Visit** - записи о посещениях

### Трекер

- Легковесный JavaScript файл (~5KB)
- Не блокирует загрузку страницы
- Поддерживает SPA (Single Page Applications)
- Автоматическое отслеживание переходов между страницами

### Производительность

- Асинхронная отправка данных
- Использование `navigator.sendBeacon` для надежной отправки
- Минимальное влияние на производительность сайта

## Примеры использования

### Отслеживание формы обратной связи

```javascript
document.getElementById("contact-form").addEventListener("submit", function () {
  window.KiruhakAnalytics.trackEvent("form_submit", {
    formType: "contact",
    page: window.location.pathname,
  });
});
```

### Отслеживание кликов по кнопкам

```javascript
document.querySelectorAll(".cta-button").forEach((button) => {
  button.addEventListener("click", function () {
    window.KiruhakAnalytics.trackEvent("cta_click", {
      buttonText: this.textContent,
      buttonClass: this.className,
    });
  });
});
```

## Поддержка

Если у вас есть вопросы или проблемы с интеграцией, обращайтесь:

- Email: kiruhak11@gmail.com
- Telegram: @kiruhak11

## Обновления

Система постоянно развивается. Следите за обновлениями на сайте kiruhak11.ru
