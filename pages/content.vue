<template>
  <NuxtLayout>
    <main class="content-page">
      <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <div class="header-section">
          <h1 class="main-title">
            <GradientText variant="primary">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</GradientText>
          </h1>
          <p class="subtitle">–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º Telegram –∫–∞–Ω–∞–ª–∞</p>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -->
        <div v-if="!isSubscribed" class="subscription-check">
          <div class="subscription-card">
            <div class="subscription-icon">
              <svg
                width="64"
                height="64"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M22 2L11 13"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M22 2L15 22L11 13L2 9L22 2Z"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <h2>–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ Telegram –∫–∞–Ω–∞–ª</h2>
            <p>
              –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à
              Telegram –∫–∞–Ω–∞–ª
            </p>

            <div class="channel-info">
              <div class="channel-card">
                <div class="channel-icon">
                  <IconTg />
                </div>
                <div class="channel-details">
                  <h3>{{ displayChannelUsername }}</h3>
                  <p>–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                </div>
              </div>
            </div>

            <button
              @click="() => checkSubscription(true)"
              class="check-button"
              :disabled="checking"
            >
              {{ checking ? "–ü—Ä–æ–≤–µ—Ä—è–µ–º..." : "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É" }}
            </button>

            <div class="subscription-steps">
              <h3>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø:</h3>
              <ol>
                <li>
                  –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª
                  <strong>{{ displayChannelUsername }}</strong>
                </li>
                <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"</li>
                <li>–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É</li>
              </ol>
            </div>
          </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ -->
        <div v-else class="exclusive-content">
          <div class="welcome-message">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª! üéâ</h2>
            <p>
              –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –Ω–∞—à Telegram –∫–∞–Ω–∞–ª. –ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ
              —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.
            </p>
          </div>

          <!-- –°–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
          <div class="content-sections">
            <!-- –¢—É—Ç–æ—Ä–∏–∞–ª—ã -->
            <div class="content-section">
              <h3>
                <GradientText variant="secondary"
                  >–¢—É—Ç–æ—Ä–∏–∞–ª—ã –ø–æ Vue.js</GradientText
                >
              </h3>
              <div class="tutorials-grid">
                <NuxtLink to="/tutorials" class="tutorial-card">
                  <div class="tutorial-header">
                    <h4>Vue 3 Composition API</h4>
                    <span class="difficulty beginner">–ù–∞—á–∏–Ω–∞—é—â–∏–π</span>
                  </div>
                  <p>
                    –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Composition API –≤ Vue 3
                  </p>
                  <div class="tutorial-meta">
                    <span>‚è±Ô∏è 15 –º–∏–Ω</span>
                    <span>üìù –ö–æ–¥ + –ø—Ä–∏–º–µ—Ä—ã</span>
                  </div>
                  <button class="tutorial-button">–ù–∞—á–∞—Ç—å —Ç—É—Ç–æ—Ä–∏–∞–ª</button>
                </NuxtLink>

                <NuxtLink to="/tutorials" class="tutorial-card">
                  <div class="tutorial-header">
                    <h4>Nuxt 3 - SSR –∏ SSG</h4>
                    <span class="difficulty intermediate">–°—Ä–µ–¥–Ω–∏–π</span>
                  </div>
                  <p>
                    –†–∞–∑–±–∏—Ä–∞–µ–º Server-Side Rendering –∏ Static Site Generation
                  </p>
                  <div class="tutorial-meta">
                    <span>‚è±Ô∏è 25 –º–∏–Ω</span>
                    <span>üöÄ –ü—Ä–æ–¥–∞–∫—à–µ–Ω</span>
                  </div>
                  <button class="tutorial-button">–ù–∞—á–∞—Ç—å —Ç—É—Ç–æ—Ä–∏–∞–ª</button>
                </NuxtLink>

                <NuxtLink to="/tutorials" class="tutorial-card">
                  <div class="tutorial-header">
                    <h4>Vue + TypeScript</h4>
                    <span class="difficulty advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</span>
                  </div>
                  <p>–¢–∏–ø–∏–∑–∞—Ü–∏—è –≤ Vue.js –ø—Ä–æ–µ–∫—Ç–∞—Ö —Å TypeScript</p>
                  <div class="tutorial-meta">
                    <span>‚è±Ô∏è 30 –º–∏–Ω</span>
                    <span>üîß TypeScript</span>
                  </div>
                  <button class="tutorial-button">–ù–∞—á–∞—Ç—å —Ç—É—Ç–æ—Ä–∏–∞–ª</button>
                </NuxtLink>
              </div>
            </div>

            <!-- –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
            <div class="content-section">
              <h3>
                <GradientText variant="warning"
                  >–ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</GradientText
                >
              </h3>
              <div class="materials-grid">
                <NuxtLink to="/materials" class="material-card">
                  <h4>–ß–µ–∫-–ª–∏—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</h4>
                  <p>
                    50+ –ø—É–Ω–∫—Ç–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Vue.js
                    –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
                  </p>
                  <button class="material-button">–û—Ç–∫—Ä—ã—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                </NuxtLink>

                <NuxtLink to="/materials" class="material-card">
                  <h4>–®–∞–±–ª–æ–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h4>
                  <p>–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</p>
                  <button class="material-button">–û—Ç–∫—Ä—ã—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                </NuxtLink>

                <NuxtLink to="/materials" class="material-card">
                  <h4>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è</h4>
                  <p>–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ –≤ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö</p>
                  <button class="material-button">–û—Ç–∫—Ä—ã—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                </NuxtLink>
              </div>
            </div>

            <!-- UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
            <div class="content-section">
              <h3>
                <GradientText variant="success">UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</GradientText>
              </h3>

              <div class="ui-components-grid">
                <!-- –î–≤–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ -->
                <div
                  v-for="component in randomTwoComponents"
                  :key="component.id"
                  class="ui-component-card"
                  @click="navigateTo('/ui-components')"
                  style="cursor: pointer"
                >
                  <div class="component-preview">
                    <div class="preview-placeholder">
                      <iframe
                        class="component-demo-frame"
                        :srcdoc="getComponentPreview(component)"
                        sandbox="allow-scripts"
                        frameborder="0"
                        loading="lazy"
                      ></iframe>
                    </div>
                  </div>
                  <div class="component-info">
                    <h4 class="component-name">{{ component.name }}</h4>
                    <p class="component-description">
                      {{ component.description || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è" }}
                    </p>
                    <div class="component-meta">
                      <span class="category-badge">{{
                        component.category
                      }}</span>
                      <span class="view-count"
                        >üëÅ {{ component.viewCount || 0 }}</span
                      >
                    </div>
                  </div>
                </div>

                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞-–ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é -->
                <div
                  class="ui-component-card cta-component-card"
                  @click="navigateTo('/ui-components')"
                >
                  <div class="cta-component-content">
                    <div class="cta-icon">üé®</div>
                    <h4 class="cta-title">–ü–æ–ª—É—á–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h4>
                    <p class="cta-description">
                      –ù–∞–∂–º–∏ –Ω–∞ –º–µ–Ω—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é UI
                      –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                    </p>
                    <div class="cta-stats-badge">
                      {{ uiComponents.length }}+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                    </div>
                    <div class="cta-arrow">‚Üí</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–¥–∞ -->
    <CodeModal
      :is-open="showCodeModal"
      :component="selectedComponent || undefined"
      @close="closeCodeModal"
    />
  </NuxtLayout>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from "vue";
import GradientText from "~/components/GradientText.vue";
import CodeModal from "~/components/CodeModal.vue";

// –¢–∏–ø—ã
interface UiComponent {
  id: string;
  name: string;
  code: string;
  html: string | null;
  css: string | null;
  js: string | null;
  description: string | null;
  category: string;
  viewCount: number;
}

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
const isSubscribed = ref(false);
const checking = ref(false);
const subscriptionCheckInterval = ref<ReturnType<typeof setInterval> | null>(
  null,
);
const runtimeConfig = useRuntimeConfig();
const rawChannelUsername = String(
  runtimeConfig.public.channelUsername || "",
).trim();
const normalizedChannelUsername =
  !rawChannelUsername ||
  rawChannelUsername.toLowerCase() === "channel" ||
  rawChannelUsername.toLowerCase() === "@channel"
    ? "webmonkey"
    : rawChannelUsername.replace(/^@/, "");
const displayChannelUsername = `@${normalizedChannelUsername}`;

// UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
const uiComponents = ref<UiComponent[]>([]);

// –î–≤–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
const randomTwoComponents = computed(() => {
  if (uiComponents.value.length === 0) {
    return [];
  }

  if (uiComponents.value.length <= 2) {
    return uiComponents.value;
  }

  // –ü–æ–ª—É—á–∞–µ–º 2 —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  const shuffled = [...uiComponents.value].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, 2);
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ Telegram –∫–∞–Ω–∞–ª
const checkSubscription = async (showAlert = true) => {
  checking.value = true;

  try {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ useAuth –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    const { user, initAuth } = useAuth();
    const { apiFetch } = useApi();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    if (!user.value) {
      await initAuth();
    }

    if (!user.value) {
      throw new Error("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω");
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ API
    const response = await apiFetch<{
      success: boolean;
      isSubscribed?: boolean;
      channelUsername?: string;
      error?: string;
      telegramError?: string;
      memberStatus?: string;
    }>("/api/telegram/check-subscription", {
      method: "POST",
    });

    if (response.success && response.isSubscribed) {
      isSubscribed.value = true;
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ localStorage
      localStorage.setItem("telegram_subscribed", "true");
    } else {
      isSubscribed.value = false;
      localStorage.removeItem("telegram_subscribed");

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
      if (showAlert) {
        alert(
          `–í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª ${displayChannelUsername}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.`,
        );
      }
    }
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:", error);
    isSubscribed.value = false;
    localStorage.removeItem("telegram_subscribed");

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    if (showAlert) {
      alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
    }
  } finally {
    checking.value = false;
  }
};

// –ó–∞–≥—Ä—É–∑–∫–∞ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const loadUiComponents = async () => {
  try {
    const response = await $fetch<{
      success: boolean;
      components?: UiComponent[];
      error?: string;
    }>("/api/ui-components");

    if (response.success && response.components) {
      uiComponents.value = response.components;
    }
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:", error);
  }
};

// –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–¥–∞
const showCodeModal = ref(false);
const selectedComponent = ref<UiComponent | null>(null);

const closeCodeModal = () => {
  showCodeModal.value = false;
  selectedComponent.value = null;
};

const getComponentPreview = (component: UiComponent) => {
  const html = component.html || component.code || "";
  const css = component.css || "";
  const js = component.js || "";
  return `
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <style>
          body { margin: 0; padding: 8px; font-family: Arial, sans-serif; }
          ${css}
        </style>
      </head>
      <body>
        ${html}
        ${js ? `<script>${js}<\/script>` : ""}
      </body>
    </html>
  `;
};

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
onMounted(async () => {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
  const { user, initAuth } = useAuth();

  if (!user.value) {
    await initAuth();
  }

  // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  if (user.value) {
    await checkSubscription(false); // –ë–µ–∑ alert –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
    subscriptionCheckInterval.value = setInterval(async () => {
      if (user.value) {
        await checkSubscription(false); // –ë–µ–∑ alert –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
      } else {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        if (subscriptionCheckInterval.value) {
          clearInterval(subscriptionCheckInterval.value);
          subscriptionCheckInterval.value = null;
        }
      }
    }, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
  }

  // –ó–∞–≥—Ä—É–∂–∞–µ–º UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  await loadUiComponents();
});

onUnmounted(() => {
  if (subscriptionCheckInterval.value) {
    clearInterval(subscriptionCheckInterval.value);
    subscriptionCheckInterval.value = null;
  }
});
</script>

<style lang="scss" scoped>
.content-page {
  min-height: 100vh;
  padding: 32px 0;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 32px;
}

.header-section {
  text-align: center;
  margin-bottom: 64px;

  .main-title {
    font-size: 3rem;
    font-weight: 700;
    margin: 0 0 16px 0;
    animation: fadeInUp 0.8s ease forwards;
  }

  .subtitle {
    font-size: 1.2rem;
    color: var(--color-text-secondary);
    margin: 0;
    animation: fadeInUp 0.8s ease forwards 0.2s;
    opacity: 0;
  }
}

// –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
.subscription-check {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 60vh;
}

.subscription-card {
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: 20px;
  padding: 48px;
  text-align: center;
  max-width: 600px;
  box-shadow: var(--card-shadow);

  h2 {
    font-size: 2rem;
    margin: 24px 0 16px 0;
    color: var(--color-text);
  }

  p {
    color: var(--color-text-secondary);
    font-size: 1.1rem;
    margin-bottom: 32px;
  }
}

.subscription-icon {
  color: var(--color-accent);
  margin-bottom: 16px;
}

.channel-info {
  margin: 32px 0;
}

.channel-card {
  display: flex;
  align-items: center;
  gap: 16px;
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 20px;
  margin: 16px 0;

  .channel-icon {
    font-size: 2rem;
    color: #0088cc;
  }

  .channel-details {
    text-align: left;

    h3 {
      margin: 0 0 4px 0;
      color: var(--color-text);
    }

    p {
      margin: 0;
      color: var(--color-text-secondary);
      font-size: 0.9rem;
    }
  }
}

.check-button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  padding: 16px 32px;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin: 24px 0;

  &:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
  }

  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

.subscription-steps {
  text-align: left;
  margin-top: 32px;

  h3 {
    margin-bottom: 16px;
    color: var(--color-text);
  }

  ol {
    color: var(--color-text-secondary);
    line-height: 1.8;

    li {
      margin-bottom: 8px;
    }

    strong {
      color: var(--color-accent);
    }
  }
}

// –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
.exclusive-content {
  animation: fadeInUp 0.8s ease forwards;
}

.welcome-message {
  text-align: center;
  margin-bottom: 64px;
  padding: 48px;
  background: linear-gradient(
    135deg,
    rgba(102, 126, 234, 0.1) 0%,
    rgba(118, 75, 162, 0.1) 100%
  );
  border-radius: 20px;
  border: 1px solid var(--border-color);

  h2 {
    font-size: 2.5rem;
    margin: 0 0 16px 0;
    color: var(--color-text);
  }

  p {
    font-size: 1.2rem;
    color: var(--color-text-secondary);
    margin: 0;
  }
}

.content-sections {
  display: grid;
  gap: 64px;
}

.content-section {
  h3 {
    font-size: 2rem;
    margin: 0 0 32px 0;
    text-align: center;
  }
}

// –°—Ç–∏–ª–∏ –¥–ª—è —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–≤
.tutorials-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
}

.tutorial-card {
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  transition: all 0.3s ease;
  box-shadow: var(--card-shadow);
  text-decoration: none;
  display: block;

  &:hover {
    transform: translateY(-4px);
    box-shadow: var(--card-shadow-hover);
    border-color: var(--color-accent);
  }

  .tutorial-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;

    h4 {
      margin: 0;
      font-size: 1.2rem;
      color: var(--color-text);
    }
  }

  .difficulty {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;

    &.beginner {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    &.intermediate {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    &.advanced {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }
  }

  p {
    color: var(--color-text-secondary);
    margin: 0 0 16px 0;
    line-height: 1.6;
  }

  .tutorial-meta {
    display: flex;
    gap: 16px;
    margin-bottom: 20px;
    font-size: 0.9rem;
    color: var(--color-text-secondary);
  }

  .tutorial-button {
    background: var(--color-accent);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;

    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
  }
}

// –°—Ç–∏–ª–∏ –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
.materials-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
}

.material-card {
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  text-align: center;
  transition: all 0.3s ease;
  box-shadow: var(--card-shadow);
  text-decoration: none;
  display: block;

  &:hover {
    transform: translateY(-4px);
    box-shadow: var(--card-shadow-hover);
    border-color: var(--color-accent);
  }

  h4 {
    font-size: 1.3rem;
    margin: 0 0 12px 0;
    color: var(--color-text);
  }

  p {
    color: var(--color-text-secondary);
    margin: 0 0 20px 0;
    line-height: 1.6;
  }

  .material-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;

    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
  }
}

// –°—Ç–∏–ª–∏ –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
.ui-components-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
}

.ui-component-card {
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.3s ease;
  box-shadow: var(--card-shadow);

  &:hover {
    transform: translateY(-4px);
    box-shadow: var(--card-shadow-hover);
    border-color: var(--color-accent);
  }
}

.component-preview {
  position: relative;
  height: 200px;
  background: var(--background-color-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.preview-image {
  width: 100%;
  height: 100%;

  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
}

.preview-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.component-demo-frame {
  width: 100%;
  height: 100%;
  border: 0;
  background: white;
}

.component-info {
  padding: 20px;
}

.component-name {
  font-size: 1.2rem;
  font-weight: 600;
  margin: 0 0 8px 0;
  color: var(--color-text);
}

.component-description {
  color: var(--color-text-secondary);
  margin: 0 0 16px 0;
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.component-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.category-badge {
  background: rgba(102, 126, 234, 0.1);
  color: var(--color-accent);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
}

.order-number {
  color: var(--color-text-secondary);
  font-size: 0.9rem;
}

.component-tags {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-bottom: 16px;
}

.tag {
  background: rgba(102, 126, 234, 0.1);
  color: var(--color-accent);
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 500;
}

.tag-more {
  background: var(--background-color-secondary);
  color: var(--color-text-secondary);
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 500;
}

.component-button {
  background: var(--color-accent);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;

  &:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }
}

// –°—Ç–∏–ª–∏ –¥–ª—è CTA –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
.cta-component-card {
  background: linear-gradient(
    135deg,
    rgba(102, 126, 234, 0.1),
    rgba(118, 75, 162, 0.1)
  );
  border: 2px dashed var(--color-accent) !important;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
  cursor: pointer;
  position: relative;
  overflow: hidden;

  &:before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(102, 126, 234, 0.1),
      transparent
    );
    transition: left 0.5s ease;
  }

  &:hover {
    background: linear-gradient(
      135deg,
      rgba(102, 126, 234, 0.15),
      rgba(118, 75, 162, 0.15)
    );
    transform: translateY(-6px) scale(1.02);

    &:before {
      left: 100%;
    }

    .cta-arrow {
      transform: translateX(10px) scale(1.2);
    }

    .cta-icon {
      transform: scale(1.1) rotate(5deg);
    }
  }
}

.cta-component-content {
  text-align: center;
  padding: 40px 20px;
  position: relative;
  z-index: 1;
}

.cta-icon {
  font-size: 4rem;
  margin-bottom: 20px;
  animation: float 3s ease-in-out infinite;
  transition: all 0.3s ease;
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-15px);
  }
}

.cta-title {
  font-size: 1.5rem;
  font-weight: 700;
  margin: 0 0 16px 0;
  color: var(--color-text);
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.cta-description {
  color: var(--color-text-secondary);
  margin: 0 0 24px 0;
  line-height: 1.6;
  font-size: 1.05rem;
}

.cta-stats-badge {
  display: inline-block;
  padding: 8px 20px;
  background: var(--gradient-primary);
  color: white;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.95rem;
  margin-bottom: 16px;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.cta-arrow {
  font-size: 2rem;
  color: var(--color-accent);
  transition: all 0.3s ease;
  font-weight: bold;
}

.view-count {
  color: var(--color-text-secondary);
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 4px;
}

// –ê–Ω–∏–º–∞—Ü–∏–∏
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
@media (max-width: 768px) {
  .header-section .main-title {
    font-size: 2rem;
  }

  .subscription-card {
    padding: 32px 24px;
  }

  .tutorials-grid,
  .materials-grid {
    grid-template-columns: 1fr;
  }

  .projects-grid {
    grid-template-columns: 1fr;
  }
}

// Hover —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫
.material-card {
  cursor: pointer;
  transition: all 0.3s ease;

  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
  }
}

.tutorial-card {
  cursor: pointer;
  transition: all 0.3s ease;

  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
  }
}
</style>
