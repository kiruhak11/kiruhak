#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ Docker..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Docker –∑–∞–ø—É—â–µ–Ω
if ! docker info > /dev/null 2>&1; then
    echo "‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—â–µ–Ω
if ! docker ps | grep -q "postgres"; then
    echo "‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å PostgreSQL –Ω–µ –Ω–∞–π–¥–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ docker-compose up -d"
    exit 1
fi

echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
npm install

echo "üîÑ –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏..."
npx prisma migrate deploy

echo "üå± –ó–∞–ø–æ–ª–Ω—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏..."
npx prisma db seed

echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!"
echo ""
echo "üìä –°–æ–∑–¥–∞–Ω–æ:"
echo "   - 1 –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (admin/admin123)"
echo "   - 4 –ø—Ä–æ–µ–∫—Ç–∞"
echo "   - 3 UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞"
echo "   - 3 –º–∞—Ç–µ—Ä–∏–∞–ª–∞"
echo "   - 2 —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ —Å —à–∞–≥–∞–º–∏ –∏ —Ç–µ—Å—Ç–∞–º–∏"
echo ""
echo "üîó –î–ª—è –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "   –õ–æ–≥–∏–Ω: admin"
echo "   –ü–∞—Ä–æ–ª—å: admin123"
echo ""
echo "ÔøΩÔøΩ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!"
